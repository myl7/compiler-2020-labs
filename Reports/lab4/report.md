# Lab4 实验报告

***REMOVED*** ***REMOVED***

***REMOVED*** ***REMOVED***

## 实验要求

整体上是实现 Cminus-f 从源码到二进制可执行程序的整个编译流程，
局部上是实现从 AST 到 LLVM IR 的翻译。

## 实验难点

Cminus-f 的语法并不简单，有相当多的 corner case 需要处理。

同时由于实现的模版 visit 不带返回值、不带自定义参数，需要传入或者传出信息给下层或上层时，需借助全局变量。
这使得整个实现中各 visit 方法高度耦合，无法轻松地拆分成若干子任务以在成员间分配。

## 实验设计

1. 在“实验难点”部分提到了，为了完成方法间信息传递，使用了全局变量作为参数或返回值。
（这不是一个好设计，但能在此框架下解决问题。）

另外值得一提的有两个：

- 在 CompoundStmt 中，需检测 early return，我们使用了 `is_returned` 全局变量来监控，保证及时终止
- 在 binary operator 的 type casting 处理中，为了避免重复代码，我们提供了一个宏函数 `BIN_CAST`

2. 隐式转换变量类型

实现了 `BIN_CAST` 宏，完成类型之间的快速转换

### 实验总结

时间安排尚不太合理

了解了 cpp 中子类和父类的转换方法

由于 cpp 缺少一些易于使用的部件，处理重复代码不太方便，使得此次实现中相当一部分代码被直接 inline 了

### 实验反馈 （可选 不会评分）

希望能加强测试样例

希望助教可以把自动测评脚本写得扩展性高一点

### 组间交流 （可选）

无
